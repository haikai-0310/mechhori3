<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒ¡ã‚«ãƒ¡ã‚«ã»ã‚Šã»ã‚Š | åŒ–çŸ³å›³é‘‘</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>

    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
        :root {
            --primary: #5D4037; --accent: #FFAB00; --pop: #FF7043;
            --bg-color: #EFEBE9; --shelf-bg: #8D6E63; --shelf-shadow: #5D4037;
            --text-dark: #3E2723; --onsen-bg: #D7CCC8; --onsen-border: #4E342E;
            --onsen-text: #3E2723; --onsen-btn: #3E2723;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px);
            background-size: 20px 20px;
            color: var(--text-dark);
            margin: 0; padding: 60px 0 0; line-height: 1.8;
            overflow-x: hidden; overscroll-behavior: none; 
        }

        .container { max-width: 800px; margin: 0 auto; padding: 20px 15px 80px; box-sizing: border-box; }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .site-header {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); z-index: 1000;
            padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }
        .header-logo { 
            text-decoration: none; cursor: pointer;
            font-weight: 900; color: var(--primary); font-size: 1.4rem;
        }

        /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¨ãƒªã‚¢ */
        .hero-area { text-align: center; padding: 30px 0 20px; }
        .hero-copy {
            display: block; font-size: 1.5rem; font-weight: 900; color: var(--pop);
            margin-bottom: 20px; letter-spacing: 0.05em; text-shadow: 2px 2px 0 #fff;
            line-height: 1.4;
        }
        .hero-logo-box {
            display: inline-block; padding: 10px 30px; border-radius: 15px;
            background: #fff; box-shadow: 6px 6px 0 var(--accent);
            border: 4px solid var(--primary); transform: rotate(-2deg);
            margin-bottom: 15px;
        }
        .hero-logo-box h1 { margin: 0; font-size: 2.2rem; color: var(--primary); letter-spacing: 0.05em; line-height: 1.2; }

        /* æ£šï¼ˆã‚°ãƒªãƒƒãƒ‰ï¼‰ */
        .shelf-container {
            background: var(--shelf-bg);
            padding: 15px; border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 10px 0 var(--shelf-shadow);
            margin-top: 20px; position: relative; z-index: 1;
        }
        .shelf-container::before {
            content: "COLLECTION";
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            background: #4E342E; color: #fff; padding: 2px 15px; font-size: 0.8rem; border-radius: 10px; font-weight: bold;
            z-index: 5;
        }

        .collection-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px 10px;
        }

        .fossil-item {
            background: #fff; border-radius: 8px; aspect-ratio: 1 / 1;
            position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; border: 2px solid #D7CCC8;
            transition: transform 0.2s; overflow: visible; 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }
        .fossil-item:active { transform: scale(0.95); }

        .fossil-item.locked { background: #ECEFF1; }
        .fossil-item.locked img { filter: brightness(0) opacity(0.2); transform: scale(0.8); }
        .fossil-item.locked::after {
            content: "?"; position: absolute; font-size: 2rem;
            color: rgba(0,0,0,0.1); font-weight: 900; pointer-events: none;
        }

        .fossil-item.unlocked { border-color: var(--accent); background: #FFF8E1; }
        .fossil-item.unlocked img { animation: pukaPuka 3s ease-in-out infinite; }
        
        .fossil-item.selected {
            border-color: var(--pop); box-shadow: 0 0 0 4px rgba(255, 112, 67, 0.3); background: #fff;
        }
        
        .grid-copyright {
            position: absolute; bottom: 2px; right: 5px; font-size: 0.5rem;
            color: #5D4037; font-weight: bold; opacity: 0.6; pointer-events: none; z-index: 5; white-space: nowrap;
        }

        .fossil-item.coming-soon { background: #D7CCC8; cursor: default; }
        .coming-text { font-size: 0.7rem; font-weight: bold; color: #fff; text-align: center; opacity: 0.7; }
        .fossil-img { width: 70%; height: 70%; object-fit: contain; position: relative; z-index: 1; }

        @keyframes pukaPuka {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.05); }
        }

        @keyframes flashEffect {
            0% { background-color: #fff; box-shadow: 0 0 50px #fff; }
            100% { background-color: #FFF8E1; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        }
        .just-unlocked { animation: flashEffect 0.6s ease-out forwards; }

        /* ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ« */
        .sparkle-particle {
            position: absolute; top: 50%; left: 50%; width: 15px; height: 15px;
            background: radial-gradient(circle, #fff 20%, #FFD700 100%);
            border-radius: 50%; pointer-events: none; z-index: 999;
            transform: translate(-50%, -50%) scale(0); opacity: 0;
            animation: sparkleFly 0.8s ease-out forwards;
        }
        @keyframes sparkleFly {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); opacity: 1; }
            50% { opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(180deg); opacity: 0; }
        }

        .tooltip-box {
            position: absolute; bottom: 105%; left: 50%; transform: translateX(-50%) scale(0.8);
            opacity: 0; pointer-events: none;
            background: rgba(255, 255, 255, 0.98); color: #333;
            padding: 8px; border-radius: 8px; width: 140px; text-align: center;
            font-size: 0.75rem; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15); border: 3px solid var(--pop);
            z-index: 200; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); transform-origin: center bottom;
        }
        .tooltip-box::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -8px;
            border-width: 8px; border-style: solid; border-color: var(--pop) transparent transparent transparent;
        }
        .fossil-item:hover .tooltip-box { transform: translateX(-50%) scale(1); opacity: 1; bottom: 110%; }

        /* è©³ç´°ã‚¨ãƒªã‚¢ */
        .detail-section {
            display: none; margin-top: 30px; background: #fff; border-radius: 15px; padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); border: 4px solid var(--primary);
            animation: slideUp 0.5s ease-out; text-align: center;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .detail-title {
            font-size: 1.8rem; margin: 0 0 20px; color: var(--primary);
            border-bottom: 2px dashed #D7CCC8; padding-bottom: 10px;
        }
        .detail-image-box {
            background: #FFF8E1; border-radius: 10px; padding: 20px;
            display: inline-block; margin-bottom: 20px; border: 2px solid var(--accent);
        }
        .detail-img-large {
            max-width: 100%; height: auto; max-height: 200px;
            filter: drop-shadow(0 4px 0 rgba(0,0,0,0.1));
            animation: pukaPuka 4s ease-in-out infinite;
        }
        .img-copyright {
            display: block; font-size: 0.75rem; color: #5D4037; margin-top: 8px;
            text-align: right; font-weight: bold; opacity: 0.8;
        }
        .detail-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.9rem; }
        .detail-table th {
            background: var(--primary); color: #fff; padding: 8px;
            border: 1px solid var(--primary); width: 30%;
        }
        .detail-table td {
            background: #fff; padding: 8px; border: 1px solid #D7CCC8;
            color: var(--text-dark); font-weight: bold;
        }
        .detail-desc-text {
            text-align: left; background: #EFEBE9; padding: 15px;
            border-radius: 8px; font-size: 0.9rem; line-height: 1.8;
            border-left: 5px solid var(--pop);
        }

        /* ãƒ‘ã‚ºãƒ«ãƒ¢ãƒ¼ãƒ‰ */
        .puzzle-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 5000;
            flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden; touch-action: none;
        }
        .puzzle-overlay.active { display: flex; animation: fadeIn 0.3s ease; }

        .puzzle-title {
            color: #fff; font-size: 1.5rem; font-weight: 900;
            margin-bottom: 20px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); pointer-events: none;
        }
        
        .puzzle-container {
            position: relative; width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
            border-radius: 50%;
        }

        .puzzle-target {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            opacity: 0.5; filter: brightness(0) invert(1); pointer-events: none; z-index: 1;
            width: auto; height: auto; max-width: 80%; max-height: 80%; object-fit: contain;
        }
        
        .puzzle-piece {
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%);
            cursor: grab; z-index: 10;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
            touch-action: none; transition: none; 
            width: auto; height: auto; max-width: 80%; max-height: 80%; object-fit: contain;
        }
        
        .puzzle-piece:active { cursor: grabbing; transform: scale(1.05); }
        .puzzle-piece.can-snap { filter: drop-shadow(0 0 20px #FFD700) brightness(1.2); }
        .puzzle-piece.snapped {
            transition: all 0.3s ease-in-out !important; 
            filter: drop-shadow(0 0 30px var(--accent)); pointer-events: none;
        }
        .puzzle-instruction {
            color: #FFAB00; font-weight: bold; margin-top: 30px;
            background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px;
            pointer-events: none;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ã‚¹ãƒãƒ³ã‚µãƒ¼ãƒ»è¦³å…‰ã‚¨ãƒªã‚¢ */
        .sponsor-area {
            margin-top: 40px; margin-bottom: 20px; text-align: center; padding: 20px;
            background: #fff; border-radius: 10px; border: 2px dashed #D7CCC8; position: relative;
        }
        .sponsor-text { font-size: 0.7rem; color: #5D4037; margin-bottom: 15px; font-weight: bold; }
        .sponsor-link-container { display: inline-block; position: relative; }
        .sponsor-hint {
            display: block; font-size: 0.6rem; color: var(--pop);
            margin-bottom: 5px; font-weight: bold; animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-5px);}
            60% {transform: translateY(-3px);}
        }
        .sponsor-link {
            display: inline-block; text-decoration: none;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), filter 0.3s;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.1));
        }
        .sponsor-link:hover, .sponsor-link:active {
            transform: scale(1.08) translateY(-5px); filter: drop-shadow(0 10px 15px rgba(0,0,0,0.15));
        }
        .sponsor-img { max-width: 200px; height: auto; display: block; margin: 0 auto; border-radius: 4px; }

        /* è¦³å…‰æƒ…å ± */
        .tourism-section {
            margin-top: 25px; padding: 25px; background-color: var(--onsen-bg); 
            border: 3px solid var(--onsen-border); border-radius: 12px; text-align: left;
            position: relative; overflow: visible; box-shadow: 0 4px 0 rgba(78, 52, 46, 0.2);
        }
        .tourism-section::before {
            content: "CHECK!"; position: absolute; top: 0; left: 0;
            background: var(--onsen-border); color: #fff;
            padding: 2px 10px; font-size: 0.7rem; font-weight: bold;
            border-bottom-right-radius: 8px; border-top-left-radius: 8px; 
        }
        .tourism-title {
            font-size: 1.2rem; color: var(--onsen-text); margin: 0 0 10px 0;
            font-weight: 900; display: flex; align-items: center; gap: 5px;
            border-bottom: 2px dotted var(--onsen-border); padding-bottom: 5px;
        }
        .tourism-desc { font-size: 0.95rem; margin-bottom: 15px; color: #4E342E; font-weight: 500; }
        .tourism-photos { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .collab-img, .onsen-img {
            width: 45%; border-radius: 8px; border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); object-fit: cover; aspect-ratio: 4/3;
            background: #fff; transition: transform 0.3s ease;
        }
        .collab-img { object-fit: contain; background: #FFF8E1; } 
        .collab-img:active, .onsen-img:active { transform: scale(0.95); }

        .tourism-btn {
            display: block; text-align: center; background: var(--onsen-btn); color: #fff;
            text-decoration: none; padding: 12px; border-radius: 30px;
            font-weight: bold; box-shadow: 0 4px 0 #271c19; 
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative; overflow: visible;
        }
        
        .notification-badge {
            position: absolute; top: -8px; right: -8px;
            background-color: #f44336; color: #fff; 
            width: 18px; height: 18px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: 900; box-shadow: 0 2px 5px rgba(244, 67, 54, 0.6);
            z-index: 10; animation: pulse-size 1s infinite alternate; 
            border: 1px solid #fff;
        }
        @keyframes pulse-size { from { transform: scale(1); } to { transform: scale(1.25); } }
        .tourism-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #271c19; }
        .tourism-btn:hover { transform: scale(1.02); }

        /* ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½ */
        .camera-fab {
            position: fixed; bottom: 20px; left: 20px;
            width: 60px; height: 60px;
            background: #fff; border: 4px solid var(--pop);
            border-radius: 50%; color: var(--text-dark);
            font-size: 2rem; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 950;
            transition: transform 0.2s;
        }
        .camera-fab:active { transform: scale(0.9); }

        .camera-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 6000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .camera-overlay.active { display: flex; }

        #camera-video { width: 100%; height: 100%; object-fit: cover; }

        /* ã‚¹ã‚­ãƒ£ãƒ³æ¼”å‡º */
        .scan-frame {
            position: absolute; top: 10%; left: 10%; width: 80%; height: 60%;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 20px; pointer-events: none;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }
        .scan-frame::before, .scan-frame::after {
            content: ""; position: absolute; width: 20px; height: 20px;
            border-color: #00E5FF; border-style: solid;
        }
        .scan-frame::before { top: -2px; left: -2px; border-width: 4px 0 0 4px; }
        .scan-frame::after { bottom: -2px; right: -2px; border-width: 0 4px 4px 0; }

        .scan-line {
            position: absolute; top: 10%; left: 10%; width: 80%; height: 2px;
            background: #00E5FF; box-shadow: 0 0 10px #00E5FF;
            animation: scanMove 2s infinite linear; opacity: 0.7; pointer-events: none;
        }
        @keyframes scanMove {
            0% { top: 10%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 70%; opacity: 0; }
        }

        .camera-message {
            position: absolute; top: 72%; color: #00E5FF; font-weight: bold;
            font-size: 0.9rem; text-shadow: 0 0 5px #000;
            background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 15px;
        }

        /* AIçµæœ */
        .ai-result-box {
            position: absolute; top: 60%; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8); color: #00E5FF;
            padding: 10px 20px; border-radius: 8px; border: 2px solid #00E5FF;
            font-weight: bold; font-size: 1rem; text-align: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            z-index: 6100; box-shadow: 0 0 15px rgba(0, 229, 255, 0.5);
        }
        .ai-result-box.show { opacity: 1; }

        .camera-controls {
            position: absolute; bottom: 30px; width: 100%;
            display: flex; justify-content: space-around; align-items: center;
        }
        .camera-action-btn {
            border: none; color: #fff; font-weight: bold; cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .camera-action-btn.close {
            background: #D32F2F; padding: 10px 20px; border-radius: 30px; font-size: 0.9rem;
        }
        .camera-action-btn.shutter {
            width: 70px; height: 70px; border-radius: 50%;
            background: #fff; border: 5px solid #ccc;
            position: relative;
        }
        .camera-action-btn.shutter::after {
            content: ""; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 55px; height: 55px;
            background: #fff; border-radius: 50%; border: 2px solid #333;
        }
        .camera-action-btn.shutter:active { transform: scale(0.95); }

        /* é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ */
        .debug-area {
            display: none; position: fixed; bottom: 90px; left: 20px; width: 320px; 
            text-align: center; padding: 0; background: #fff;
            border: 2px solid #546E7A; border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 3000; overflow: hidden;
        }
        .debug-header {
            background: #546E7A; color: #fff; padding: 8px;
            cursor: move; font-weight: bold; font-size: 0.9rem; user-select: none;
        }
        .debug-content { padding: 15px; }
        .debug-btn { 
            margin: 3px; padding: 6px 10px; border: none; background: #78909C; color: #fff; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
        }
        .debug-reset { background: #E65100; font-weight:bold; width: 100%; margin: 5px 0; }
        .debug-close { background: #d32f2f; margin-top: 10px; width: 100%; }

        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7); color: white; padding: 8px 16px; border-radius: 20px;
            font-size: 0.85rem; z-index: 7000; opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; }
        
        .scroll-top-btn {
            position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px;
            background: var(--pop); color: #fff; border: none; border-radius: 50%;
            font-size: 1.5rem; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 900; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s, transform 0.2s;
        }
        .scroll-top-btn.show { opacity: 1; pointer-events: auto; }

        footer { background: #4E342E; color: #D7CCC8; padding: 20px; text-align: center; font-size: 0.7rem; }
    </style>
</head>
<body>

<header class="site-header">
    <a href="index.html" class="header-logo">ãƒ¡ã‚«ãƒ¡ã‚«ã»ã‚Šã»ã‚Š</a>
</header>

<div class="container">
    <div class="hero-area">
        <div class="hero-logo-box"><h1>åŒ–çŸ³å›³é‘‘</h1></div><br>
        <span class="hero-copy">æ˜ã‚Šå‡ºã›ï¼æœªæ¥ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ï¼</span>
        <span class="concept">ã™ã¹ã¦ã®åŒ–çŸ³ã‚’é›†ã‚ã‚ˆã†ï¼</span>
    </div>

    <div class="shelf-container">
        <div class="collection-grid" id="grid-container"></div>
    </div>

    <div id="detail-section" class="detail-section">
        <h2 id="dino-info-name" class="detail-title">æç«œã®åå‰</h2>
        
        <div class="detail-image-box">
            <img id="dino-info-img" src="" class="detail-img-large" alt="åŒ–çŸ³ã®è©³ç´°ç”»åƒ">
            <div id="dino-img-copyright" class="img-copyright"></div>
        </div>

        <table class="detail-table">
            <tr><th>åå‰ã®ç”±æ¥</th><td id="dino-info-name-origin">-</td></tr>
            <tr><th>å¤§ãã•(å…¨é•·)</th><td id="dino-info-size">-</td></tr>
            <tr><th>é‡ã•</th><td id="dino-info-weight">-</td></tr>
            <tr><th>åˆ†é¡</th><td id="dino-info-class">-</td></tr>
            <tr><th>æ™‚ä»£</th><td id="dino-info-era">-</td></tr>
            <tr><th>ç”£å‡ºå›½</th><td id="dino-info-origin">-</td></tr>
        </table>

        <div id="dino-info-desc" class="detail-desc-text">ã“ã“ã«è©³ã—ã„èª¬æ˜ãŒå…¥ã‚Šã¾ã™ã€‚</div>

        <div id="tourism-container" style="display:none;">
            <div class="tourism-section">
                <h3 class="tourism-title" id="tourism-title">ğŸ¦• è¦³å…‰æç«œã‚³ãƒ©ãƒ </h3>
                <p class="tourism-desc" id="tourism-desc">ã“ã“ã«è¦³å…‰æƒ…å ±ãŒå…¥ã‚Šã¾ã™ã€‚</p>
                <div class="tourism-photos">
                    <img id="tourism-dino-img" src="" class="collab-img" alt="æç«œ">
                    <img id="tourism-spot-img" src="" class="onsen-img" alt="è¦³å…‰åœ°">
                </div>
                <a href="#" target="_blank" class="tourism-btn" id="tourism-link">
                    å…¬å¼ã‚µã‚¤ãƒˆã¸GO! <div class="notification-badge">!</div>
                </a>
            </div>
        </div>
    </div>

    <div class="sponsor-area">
        <div class="sponsor-text">æœ¬åŒ–çŸ³ã®ç™ºæ˜ã«ã¯æ ªå¼ä¼šç¤¾ã‚¢ã‚µãƒä¸ç‡ƒã€ä¸ç‡ƒæœ¨æï¼ˆã‚¹ã‚µãƒãƒ²ï¼‰ã€ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™</div>
        <div class="sponsor-link-container">
            <span class="sponsor-hint">â–¼ ç”»åƒã‚’ã‚¿ãƒƒãƒ—ã§ä¼šç¤¾æƒ…å ±ã‚’ãƒã‚§ãƒƒã‚¯ï¼ â–¼</span>
            <a href="https://funen.jp/susanoh" target="_blank" class="sponsor-link">
                <img src="images/asanofune_logo.jpg" alt="æ ªå¼ä¼šç¤¾ã‚¢ã‚µãƒä¸ç‡ƒ" class="sponsor-img">
            </a>
        </div>
    </div>

    <div class="debug-area" id="debug-section">
        <div class="debug-header" id="debug-drag-handle">ğŸ›  é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ (Move Me)</div>
        <div class="debug-content">
            <div style="margin-bottom:5px;">
                <button class="debug-btn" onclick="simulateNFC('ammonite')">ã‚¢ãƒ³ãƒ¢</button>
                <button class="debug-btn" onclick="simulateNFC('trilobite')">ä¸‰è‘‰è™«</button>
                <button class="debug-btn" onclick="simulateNFC('spino')">ã‚¹ãƒ”ãƒ</button>
                <button class="debug-btn" onclick="simulateNFC('fukuiraptor')">ãƒ•ã‚¯ã‚¤</button>
                <button class="debug-btn" onclick="simulateNFC('trex')">ãƒ†ã‚£ãƒ©ãƒ</button>
            </div>
            <button class="debug-btn debug-reset" onclick="resetCollection()">â†» å›³é‘‘ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="debug-btn debug-close" onclick="disableDebugMode()">çµ‚äº†ã™ã‚‹</button>
        </div>
    </div>
</div>

<button id="camera-open-btn" class="camera-fab">ğŸ“·</button>

<div id="camera-overlay" class="camera-overlay">
    <video id="camera-video" autoplay playsinline muted></video>
    
    <div class="scan-frame"></div>
    <div class="scan-line"></div>
    <div class="camera-message">è¦³å…‰åœ°ã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</div>
    
    <div id="ai-result-box" class="ai-result-box">AIæº–å‚™ä¸­...</div>

    <div class="camera-controls">
        <button id="camera-close-btn" class="camera-action-btn close">ã¨ã˜ã‚‹</button>
        <button id="camera-shutter-btn" class="camera-action-btn shutter"></button>
    </div>
</div>

<div id="puzzle-overlay" class="puzzle-overlay">
    <div class="puzzle-title">FOSSIL FOUND!</div>
    <div class="puzzle-container" id="puzzle-play-area">
        <img id="puzzle-target" class="puzzle-target" src="" alt="target">
        <img id="puzzle-piece" class="puzzle-piece" src="" alt="piece">
    </div>
    <p class="puzzle-instruction">ã‚¹ãƒ©ã‚¤ãƒ‰ã—ã¦ã¯ã‚ã“ã‚‚ã†ï¼</p>
</div>

<div id="toast" class="toast"></div>
<button id="scroll-top-btn" class="scroll-top-btn">â–²</button>

<footer>
    <span id="copyright-trigger" style="user-select: none;">Â© 2026 MECHAMECHA HORIHORI</span>
</footer>

<audio id="sfx-sparkle" src="sparkle.mp3" preload="auto"></audio>
<audio id="sfx-snap" src="snap.mp3" preload="auto"></audio>

<script>
    // --- AIãƒ¢ãƒ‡ãƒ«ã®ãƒ­ãƒ¼ãƒ‰ (TensorFlow.js) ---
    let aiModel = null;
    const aiResultBox = document.getElementById('ai-result-box');

    window.addEventListener('load', () => {
        if (typeof cocoSsd !== 'undefined') {
            cocoSsd.load().then(model => {
                aiModel = model;
                console.log("AI Model Loaded!");
                if(aiResultBox) aiResultBox.innerText = "AIã‚·ã‚¹ãƒ†ãƒ : æº–å‚™å®Œäº†";
            }).catch(err => {
                console.error("AI Model Load Error:", err);
            });
        }
    });

    const fossils = [
        { 
            id: 'ammonite', name: 'ã‚¢ãƒ³ãƒ¢ãƒŠã‚¤ãƒˆ', 
            img: 'images/ammonite.png', detailImg: 'images/ammonite.jpg',
            hint: ['ãã‚‹ãã‚‹ã—ã¦ã„ã‚‹â€¦', 'æµ·ã«ã„ãŸã‚‰ã—ã„'], 
            desc: ['ã€ã‚¢ãƒ³ãƒ¢ãƒŠã‚¤ãƒˆã€‘', 'ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ã‚’è¦‹ã‚‹'],
            data: {
                nameOrigin: 'ã‚¢ãƒ¢ãƒ³ï¼ˆã‚¨ã‚¸ãƒ—ãƒˆã®ç¥ï¼‰ã®è§’', size: 'ç´„2cm ã€œ 2m', weight: 'æ•°g ã€œ æ•°åkg',
                class: 'é ­è¶³é¡ï¼ˆã‚¤ã‚«ãƒ»ã‚¿ã‚³ã®ä»²é–“ï¼‰', era: 'ãƒ‡ãƒœãƒ³ç´€ ã€œ ç™½äºœç´€ (æœ«æœŸ)', origin: 'ä¸–ç•Œä¸­',
                longDesc: '<ruby>æ¸¦å·»<rt>ã†ãšã¾</rt></ruby>ã<ruby>çŠ¶<rt>ã˜ã‚‡ã†</rt></ruby>ã®<ruby>æ®»<rt>ã‹ã‚‰</rt></ruby>ã‚’<ruby>æŒ<rt>ã‚‚</rt></ruby>ã£ã¦ã„ãŸ<ruby>æµ·<rt>ã†ã¿</rt></ruby>ã®<ruby>ç”Ÿ<rt>ã„</rt></ruby>ã<ruby>ç‰©<rt>ã‚‚ã®</rt></ruby>ã ã‚ˆã€‚<ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ãŒ<ruby>ç”Ÿ<rt>ã„</rt></ruby>ãã¦ã„ãŸ<ruby>æ™‚ä»£<rt>ã˜ã ã„</rt></ruby>ã‚ˆã‚Šãšã£ã¨<ruby>å‰<rt>ã¾ãˆ</rt></ruby>ã‹ã‚‰ã€<ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ãŒã„ãªããªã‚‹ã¾ã§ã€<ruby>é•·<rt>ãªãŒ</rt></ruby>ã„<ruby>é–“<rt>ã‚ã„ã </rt></ruby><ruby>ä¸–ç•Œä¸­<rt>ã›ã‹ã„ã˜ã‚…ã†</rt></ruby>ã®<ruby>æµ·<rt>ã†ã¿</rt></ruby>ã§<ruby>ç¹æ „<rt>ã¯ã‚“ãˆã„</rt></ruby>ã—ã¦ã„ãŸã‚“ã ã€‚<ruby>æ®»<rt>ã‹ã‚‰</rt></ruby>ã®<ruby>ä¸­<rt>ãªã‹</rt></ruby>ã«ã‚¬ã‚¹ã‚„<ruby>æ°´<rt>ã¿ãš</rt></ruby>ã‚’<ruby>å…¥<rt>ã„</rt></ruby>ã‚Œã¦ã€<ruby>æµ·<rt>ã†ã¿</rt></ruby>ã®<ruby>ä¸­<rt>ãªã‹</rt></ruby>ã‚’ãƒ•ãƒ¯ãƒ•ãƒ¯ã¨<ruby>æ¼‚<rt>ãŸã ã‚ˆ</rt></ruby>ã£ã¦ã„ãŸã¨<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã€‚',
                tourism: {
                    title: 'çµ¶æ™¯ï¼æ±å°‹åŠï¼ˆã¨ã†ã˜ã‚“ã¼ã†ï¼‰',
                    desc: 'ã‚¢ãƒ³ãƒ¢ãƒŠã‚¤ãƒˆã¯æµ·ã«ã„ãŸã‹ã‚‰ã€ç¦äº•ã®æµ·ã¨ã„ãˆã°ã“ã“ï¼æ–­å´–çµ¶å£ã®ã€Œæ±å°‹åŠã€ï¼æ—¥æœ¬æµ·ã®è’æ³¢ãŒä½œã‚Šå‡ºã—ãŸå¤§è¿«åŠ›ã®æ™¯è‰²ã‚’è¦‹ã«è¡Œã“ã†ï¼',
                    link: 'https://kanko-sakai.com/tojinbo/', linkText: 'æ±å°‹åŠã®è©³ç´°ã‚’è¦‹ã‚‹',
                    dinoImg: 'images/ammonite.png', spotImg: 'images/tojinbo.jpg'
                }
            }
        },
        { 
            id: 'spino', name: 'ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹', 
            img: 'images/spinosaurus.png', detailImg: 'images/spinosaurus.jpg', imageCopyright: 'Â© 2024-2025 Spino ã‚Šã‚“',
            hint: ['æ°´è¾ºã§æš®ã‚‰ã—ã¦ã„ãŸ', 'æç«œã®æ­¯â€¦ï¼Ÿ'], desc: ['ã€ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹ã€‘', 'ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ã‚’è¦‹ã‚‹'],
            data: {
                nameOrigin: 'æ£˜ã®ã‚ã‚‹ãƒˆã‚«ã‚²', size: 'ç´„14m', weight: 'ç´„7t',
                class: 'ç£è„šé¡ï¼ˆè‚‰é£Ÿæç«œï¼‰', era: 'ç™½äºœç´€å¾ŒæœŸ (ã‚»ãƒãƒãƒ‹ã‚¢ãƒ³)', origin: 'ã‚¨ã‚¸ãƒ—ãƒˆã€ãƒ¢ãƒ­ãƒƒã‚³',
                longDesc: '<ruby>èƒŒä¸­<rt>ã›ãªã‹</rt></ruby>ã«ã‚ã‚‹<ruby>å¤§<rt>ãŠãŠ</rt></ruby>ããªã€Œ<ruby>å¸†<rt>ã»</rt></ruby>ã€ãŒ<ruby>ç‰¹å¾´çš„<rt>ã¨ãã¡ã‚‡ã†ã¦ã</rt></ruby>ãª<ruby>å·¨å¤§<rt>ãã‚‡ã ã„</rt></ruby>ãª<ruby>è‚‰é£Ÿ<rt>ã«ãã—ã‚‡ã</rt></ruby><ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ã ã‚ˆã€‚ãƒ¯ãƒ‹ã®ã‚ˆã†ã«<ruby>å£<rt>ãã¡</rt></ruby>ãŒ<ruby>ç´°é•·<rt>ã»ããªãŒ</rt></ruby>ãã€<ruby>æ°´è¾º<rt>ã¿ãšã¹</rt></ruby>ã§<ruby>é­š<rt>ã•ã‹ãª</rt></ruby>ã‚’<ruby>æ•<rt>ã¤ã‹</rt></ruby>ã¾ãˆã¦<ruby>é£Ÿ<rt>ãŸ</rt></ruby>ã¹ã¦ã„ãŸã¨<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‰ã‚Œã¦ã„ã‚‹ã‚“ã ã€‚<ruby>å²ä¸Š<rt>ã—ã˜ã‚‡ã†</rt></ruby><ruby>æœ€å¤§ç´š<rt>ã•ã„ã ã„ãã‚…ã†</rt></ruby>ã®<ruby>è‚‰é£Ÿ<rt>ã«ãã—ã‚‡ã</rt></ruby><ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ã®ã²ã¨ã¤ã ã¨<ruby>è¨€<rt>ã„</rt></ruby>ã‚ã‚Œã¦ã„ã‚‹ã‚ˆï¼',
                tourism: {
                    title: 'ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹ Ã— ã‚ã‚ã‚‰æ¸©æ³‰',
                    desc: 'ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹ã¯åŠæ°´æ£²ã§æ°´è¾ºãŒå¤§å¥½ãã§ã—ãŸã€‚ç¦äº•ã§æ°´ã¨ã„ãˆã°ã€Œã‚ã‚ã‚‰æ¸©æ³‰ã€ï¼ç™ºæ˜ã§ç–²ã‚ŒãŸä½“ã‚’ã€ã‚¹ãƒ”ãƒã‚µã‚¦ãƒ«ã‚¹ã¨ä¸€ç·’ã«æ¸©æ³‰ã§ç™’ã‚„ã—ã¾ã›ã‚“ã‹ï¼Ÿ',
                    link: 'https://www.awara-onsen.org/', linkText: 'ã‚ã‚ã‚‰æ¸©æ³‰ã®è©³ç´°ã‚’è¦‹ã‚‹',
                    dinoImg: 'images/spinosaurus.png', spotImg: 'images/awara_onsen.jpg' 
                }
            }
        },
        { 
            id: 'trex', name: 'ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹', 
            img: 'images/tyrannosaurus.png', detailImg: 'images/tyrannosaurus.jpg',
            hint: ['æœ€å¼·ã®æç«œã®', 'ã‚­ãƒã‹ã‚‚ã—ã‚Œãªã„â€¦'], desc: ['ã€ãƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹ã€‘', 'ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ã‚’è¦‹ã‚‹'],
            data: {
                nameOrigin: 'æš´å›ãƒˆã‚«ã‚²ã®ç‹', size: 'ç´„13m', weight: 'ç´„6t ã€œ 9t',
                class: 'ç£è„šé¡ï¼ˆè‚‰é£Ÿæç«œï¼‰', era: 'ç™½äºœç´€å¾ŒæœŸ (ãƒãƒ¼ã‚¹ãƒˆãƒªãƒ’ãƒã‚¢ãƒ³)', origin: 'ã‚¢ãƒ¡ãƒªã‚«ã€ã‚«ãƒŠãƒ€',
                longDesc: 'ã€Œ<ruby>æš´å›<rt>ã¼ã†ãã‚“</rt></ruby>ãƒˆã‚«ã‚²ã®<ruby>ç‹<rt>ãŠã†</rt></ruby>ã€ã¨ã„ã†<ruby>æ„å‘³<rt>ã„ã¿</rt></ruby>ã®<ruby>åå‰<rt>ãªã¾ãˆ</rt></ruby>ã‚’<ruby>æŒ<rt>ã‚‚</rt></ruby>ã¤ã€ã‚‚ã£ã¨ã‚‚<ruby>æœ‰å<rt>ã‚†ã†ã‚ã„</rt></ruby>ãª<ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ã ã­ã€‚<ruby>å¤ª<rt>ãµã¨</rt></ruby>ãã¦<ruby>é•·<rt>ãªãŒ</rt></ruby>ã„<ruby>æ­¯<rt>ã¯</rt></ruby>ã¨ã€ã¨ã¦ã¤ã‚‚ãªã<ruby>å¼·<rt>ã¤ã‚ˆ</rt></ruby>ã„ã‚¢ã‚´ã®<ruby>åŠ›<rt>ã¡ã‹ã‚‰</rt></ruby>ã§ã€<ruby>ç²ç‰©<rt>ãˆã‚‚ã®</rt></ruby>ã®<ruby>éª¨<rt>ã»ã­</rt></ruby>ã¾ã§<ruby>å™›<rt>ã‹</rt></ruby>ã¿<ruby>ç •<rt>ãã </rt></ruby>ã„ã¦ã—ã¾ã£ãŸã¨<ruby>è¨€<rt>ã„</rt></ruby>ã‚ã‚Œã¦ã„ã‚‹ã‚ˆã€‚<ruby>å—…è¦š<rt>ãã‚…ã†ã‹ã</rt></ruby>ã‚‚ã¨ã¦ã‚‚<ruby>å„ª<rt>ã™ã</rt></ruby>ã‚Œã¦ã„ãŸã‚“ã ã€‚',
                tourism: {
                    title: 'ç¦äº•é§…å‰ã®æç«œãƒ­ãƒœãƒƒãƒˆ',
                    desc: 'åŒ—é™¸æ–°å¹¹ç·šã®ç¦äº•é–‹æ¥­ã§ã€ç¦äº•é§…å‰ã¯ã¾ã•ã«ã€Œæç«œç‹å›½ã€ã®ç„é–¢å£ï¼å®Ÿç‰©å¤§ã®å‹•ããƒ†ã‚£ãƒ©ãƒã‚µã‚¦ãƒ«ã‚¹ãƒ­ãƒœãƒƒãƒˆãŒå¤§è¿«åŠ›ã§ãŠå‡ºè¿ãˆã—ã¦ãã‚Œã‚‹ã‚ˆï¼',
                    link: 'https://www.fukuicity-navi.com/100_dino/', linkText: 'é§…å‰ã®æç«œã‚’è¦‹ã‚‹',
                    dinoImg: 'images/tyrannosaurus.png', spotImg: 'images/fukui_station_dino.jpg'
                }
            }
        },
        { 
            id: 'trilobite', name: 'ä¸‰è‘‰è™«', 
            img: 'images/trilobite.png', detailImg: 'images/trilobite.jpg',
            hint: ['æµ·ã®åº•ã‚’', 'ã¯ã£ã¦ã„ãŸã‚‰ã—ã„â€¦'], desc: ['ã€ä¸‰è‘‰è™«ã€‘', 'ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ã‚’è¦‹ã‚‹'],
            data: {
                nameOrigin: '3ã¤ã®è‘‰ï¼ˆã¾ãŸï¼‰', size: 'ç´„5mm ã€œ 70cm', weight: 'ã¨ã£ã¦ã‚‚è»½ã„',
                class: 'ç¯€è¶³å‹•ç‰©', era: 'ã‚«ãƒ³ãƒ–ãƒªã‚¢ç´€ ã€œ ãƒšãƒ«ãƒ ç´€ (æœ«æœŸ)', origin: 'ä¸–ç•Œä¸­',
                longDesc: '<ruby>ä»Š<rt>ã„ã¾</rt></ruby>ã®ãƒ€ãƒ³ã‚´ãƒ ã‚·ã‚„ã‚¨ãƒ“ã®<ruby>é <rt>ã¨ãŠ</rt></ruby>ã„<ruby>è¦ªæˆš<rt>ã—ã‚“ã›ã</rt></ruby>ã ã‚ˆã€‚<ruby>ä½“<rt>ã‹ã‚‰ã </rt></ruby>ãŒã€Œ<ruby>å·¦<rt>ã²ã ã‚Š</rt></ruby>ãƒ»<ruby>çœŸ<rt>ã¾</rt></ruby>ã‚“<ruby>ä¸­<rt>ãªã‹</rt></ruby>ãƒ»<ruby>å³<rt>ã¿ã</rt></ruby>ã€ã®3ã¤ã®<ruby>éƒ¨åˆ†<rt>ã¶ã¶ã‚“</rt></ruby>ã«<ruby>åˆ†<rt>ã‚</rt></ruby>ã‹ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã€Œ<ruby>ä¸‰è‘‰è™«<rt>ã•ã‚“ã‚ˆã†ã¡ã‚…ã†</rt></ruby>ã€ã¨<ruby>å‘¼<rt>ã‚ˆ</rt></ruby>ã°ã‚Œã‚‹ã‚“ã ã€‚<ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ãŒ<ruby>ç”Ÿ<rt>ã†</rt></ruby>ã¾ã‚Œã‚‹ã‚ˆã‚Šã‚‚ãšã£ã¨<ruby>æ˜”<rt>ã‚€ã‹ã—</rt></ruby>ã®<ruby>æµ·<rt>ã†ã¿</rt></ruby>ã§ã€<ruby>å¤§ç¹æ „<rt>ã ã„ã¯ã‚“ãˆã„</rt></ruby>ã—ã¦ã„ãŸ<ruby>ç”Ÿ<rt>ã„</rt></ruby>ã<ruby>ç‰©<rt>ã‚‚ã®</rt></ruby>ã ã‚ˆã€‚',
                tourism: {
                    title: 'ç¾ã—ã™ãã‚‹æµ·ï¼æ°´æ™¶æµœ',
                    desc: 'ä¸‰è‘‰è™«ã¯æµ·ã®åº•ã‚’é€™ã£ã¦ã„ãŸã­ã€‚ç¦äº•ã§æµ·ã¨ã„ãˆã°ã€é€æ˜åº¦æŠœç¾¤ã®ã€Œæ°´æ™¶æµœï¼ˆã™ã„ã—ã‚‡ã†ã¯ã¾ï¼‰ã€ï¼ã¾ã‚‹ã§å®çŸ³ã®ã‚ˆã†ã«ã‚­ãƒ©ã‚­ãƒ©è¼ãç ‚æµœã«è¡Œã£ã¦ã¿ã‚ˆã†ï¼',
                    link: 'https://www.wakasa-mihama.jp/spot/suishohama/', linkText: 'æ°´æ™¶æµœã®è©³ç´°ã‚’è¦‹ã‚‹',
                    dinoImg: 'images/trilobite.png', spotImg: 'images/suishohama.jpg' 
                }
            }
        },
        { 
            id: 'fukuiraptor', name: 'ãƒ•ã‚¯ã‚¤ãƒ©ãƒ—ãƒˆãƒ«', 
            img: 'images/fukuiraptor.png', detailImg: 'images/fukuiraptor.jpg', 
            hint: ['æ—¥æœ¬ã§è¦‹ã¤ã‹ã£ãŸ', 'è‚‰é£Ÿæç«œã®ãƒ„ãƒ¡â€¦ï¼Ÿ'], desc: ['ã€ãƒ•ã‚¯ã‚¤ãƒ©ãƒ—ãƒˆãƒ«ã€‘', 'ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ã‚’è¦‹ã‚‹'], 
            data: {
                nameOrigin: 'ç¦äº•ã®æ³¥æ£’', size: 'ç´„4.2m', weight: 'ç´„300kg',
                class: 'ç£è„šé¡ï¼ˆãƒ¡ã‚¬ãƒ©ãƒ—ãƒˆãƒ«é¡ã¨è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹ï¼‰', era: 'ç™½äºœç´€å‰æœŸ (ãƒãƒ¬ãƒŸã‚¢ãƒ³)', origin: 'æ—¥æœ¬ï¼ˆç¦äº•çœŒï¼‰',
                longDesc: '<ruby>æ—¥æœ¬<rt>ã«ã»ã‚“</rt></ruby>ã®<ruby>ç¦äº•çœŒ<rt>ãµãã„ã‘ã‚“</rt></ruby><ruby>å‹å±±å¸‚<rt>ã‹ã¤ã‚„ã¾ã—</rt></ruby>ã§<ruby>ç™ºè¦‹<rt>ã¯ã£ã‘ã‚“</rt></ruby>ã•ã‚ŒãŸ<ruby>è‚‰é£Ÿ<rt>ã«ãã—ã‚‡ã</rt></ruby><ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ã ã‚ˆï¼<ruby>å¤§<rt>ãŠãŠ</rt></ruby>ããª<ruby>æ‰‹<rt>ã¦</rt></ruby>ã®<ruby>çˆª<rt>ã¤ã‚</rt></ruby>ãŒ<ruby>ç‰¹å¾´<rt>ã¨ãã¡ã‚‡ã†</rt></ruby>ãªã‚“ã ã€‚ã“ã‚Œã‚’<ruby>ä½¿<rt>ã¤ã‹</rt></ruby>ã£ã¦<ruby>ç²ç‰©<rt>ãˆã‚‚ã®</rt></ruby>ã‚’<ruby>æ•<rt>ã¤ã‹</rt></ruby>ã¾ãˆã¦ã„ãŸã¨<ruby>è€ƒ<rt>ã‹ã‚“ãŒ</rt></ruby>ãˆã‚‰ã‚Œã¦ã„ã‚‹ã‚ˆã€‚<ruby>æ—¥æœ¬<rt>ã«ã»ã‚“</rt></ruby>ã«ã‚‚ã“ã‚“ãªã«ã‹ã£ã“ã„ã„<ruby>æç«œ<rt>ãã‚‡ã†ã‚Šã‚…ã†</rt></ruby>ãŒã„ãŸãªã‚“ã¦ã™ã”ã„ã­ï¼',
                tourism: {
                    title: 'è–åœ°ï¼æç«œåšç‰©é¤¨',
                    desc: 'ãƒ•ã‚¯ã‚¤ãƒ©ãƒ—ãƒˆãƒ«ã«ä¼šã„ãŸã„ãªã‚‰ã“ã“ã—ã‹ãªã„ï¼ä¸–ç•Œä¸‰å¤§æç«œåšç‰©é¤¨ã®ã²ã¨ã¤ã€ç¦äº•çœŒç«‹æç«œåšç‰©é¤¨ã¸è¡Œã“ã†ï¼',
                    link: 'https://www.dinosaur.pref.fukui.jp/', linkText: 'åšç‰©é¤¨ã®ã‚µã‚¤ãƒˆã¸',
                    dinoImg: 'images/fukuiraptor.png', spotImg: 'images/fukui_museum.jpg'
                }
            }
        },
        { id: 'coming1', type: 'coming_soon' },
        { id: 'coming2', type: 'coming_soon' },
        { id: 'coming3', type: 'coming_soon' },
        { id: 'coming4', type: 'coming_soon' }
    ];

    let unlockedStatus = { ammonite: false, spino: false, trex: false, trilobite: false, fukuiraptor: false };
    const SAVE_KEY = 'mechMechCollection_v2'; 
    
    // â–¼ è¦³å…‰ãƒªãƒ³ã‚¯ã®è¨ªå•çŠ¶æ…‹ç®¡ç† â–¼
    let visitedLinks = {}; 
    const TOURISM_KEY = 'mechMechTourism_v1';

    function loadStatus() {
        try {
            const saved = localStorage.getItem(SAVE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(unlockedStatus).forEach(key => {
                    if (typeof data[key] === 'boolean') unlockedStatus[key] = data[key];
                });
            }
            // è¦³å…‰ãƒªãƒ³ã‚¯ã®çŠ¶æ…‹èª­ã¿è¾¼ã¿
            const tourismSaved = localStorage.getItem(TOURISM_KEY);
            if (tourismSaved) visitedLinks = JSON.parse(tourismSaved);

        } catch (e) { console.warn('Save corrupted', e); }
    }
    loadStatus();
    function saveStatus() { localStorage.setItem(SAVE_KEY, JSON.stringify(unlockedStatus)); }
    function saveTourismStatus() { localStorage.setItem(TOURISM_KEY, JSON.stringify(visitedLinks)); }

    const ui = {
        grid: document.getElementById('grid-container'),
        detail: {
            section: document.getElementById('detail-section'),
            name: document.getElementById('dino-info-name'),
            img: document.getElementById('dino-info-img'),
            copyright: document.getElementById('dino-img-copyright'), 
            nameOrigin: document.getElementById('dino-info-name-origin'),
            size: document.getElementById('dino-info-size'),
            weight: document.getElementById('dino-info-weight'),
            class: document.getElementById('dino-info-class'),
            era: document.getElementById('dino-info-era'),
            origin: document.getElementById('dino-info-origin'),
            desc: document.getElementById('dino-info-desc'),
            tourismContainer: document.getElementById('tourism-container'),
            tourismTitle: document.getElementById('tourism-title'),
            tourismDesc: document.getElementById('tourism-desc'),
            tourismLink: document.getElementById('tourism-link'),
            tourismDinoImg: document.getElementById('tourism-dino-img'),
            tourismSpotImg: document.getElementById('tourism-spot-img')
        },
        audio: document.getElementById('sfx-sparkle'),
        snapAudio: document.getElementById('sfx-snap') || document.getElementById('sfx-sparkle')
    };

    function setMultilineText(container, lines) {
        if (!container) return;
        container.textContent = ''; 
        const lineArray = Array.isArray(lines) ? lines : [lines];
        lineArray.forEach((line, index) => {
            container.appendChild(document.createTextNode(line));
            if (index < lineArray.length - 1) container.appendChild(document.createElement('br'));
        });
    }

    // --- Gridç”Ÿæˆ ---
    fossils.forEach(f => {
        const div = document.createElement('div');
        div.className = 'fossil-item';
        div.id = `item-${f.id}`;
        
        if (f.type === 'coming_soon') {
            div.classList.add('coming-soon');
            const textDiv = document.createElement('div');
            textDiv.className = 'coming-text';
            setMultilineText(textDiv, ['COMING', 'SOON', '...']);
            div.appendChild(textDiv);
        } else {
            const img = document.createElement('img');
            img.src = f.img; img.className = 'fossil-img'; img.alt = f.name;
            
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip-box'; tooltip.id = `tooltip-${f.id}`;
            
            if (unlockedStatus[f.id]) {
                div.classList.add('unlocked');
                setMultilineText(tooltip, f.desc);
            } else {
                div.classList.add('locked');
                setMultilineText(tooltip, f.hint);
            }
            
            div.appendChild(img);
            div.appendChild(tooltip);

            if (f.imageCopyright) {
                const copyDiv = document.createElement('div');
                copyDiv.className = 'grid-copyright';
                copyDiv.textContent = f.imageCopyright;
                div.appendChild(copyDiv);
            }
            
            div.addEventListener('click', () => {
                if (unlockedStatus[f.id]) showDetails(f.id);
                else {
                    div.style.transform = "translateX(5px)";
                    setTimeout(() => div.style.transform = "none", 100);
                }
            });
        }
        ui.grid.appendChild(div);
    });

    function showDetails(id) {
        const data = fossils.find(f => f.id === id);
        if (!data) return;

        document.querySelectorAll('.fossil-item').forEach(el => el.classList.remove('selected'));
        const targetItem = document.getElementById(`item-${id}`);
        if(targetItem) targetItem.classList.add('selected');

        const d = ui.detail;
        if(d.name) d.name.textContent = data.name;
        if(d.img) { d.img.src = data.detailImg || data.img; d.img.alt = data.name; }
        if(d.copyright) d.copyright.textContent = data.imageCopyright || '';
        if(d.nameOrigin) d.nameOrigin.textContent = data.data.nameOrigin;
        if(d.size) d.size.textContent = data.data.size;
        if(d.weight) d.weight.textContent = data.data.weight;
        if(d.class) d.class.textContent = data.data.class;
        if(d.era) d.era.textContent = data.data.era;
        if(d.origin) d.origin.textContent = data.data.origin;
        if(d.desc) d.desc.innerHTML = data.data.longDesc;

        // â–¼â–¼â–¼ è¦³å…‰ãƒªãƒ³ã‚¯ã®ã€Œï¼ã€ãƒãƒ¼ã‚¯åˆ¶å¾¡ â–¼â–¼â–¼
        if (data.data.tourism && d.tourismContainer) {
            d.tourismContainer.style.display = 'block';
            if(d.tourismTitle) d.tourismTitle.textContent = `ğŸ¦• ${data.data.tourism.title}`;
            if(d.tourismDesc) d.tourismDesc.textContent = data.data.tourism.desc;
            
            if(d.tourismLink) {
                d.tourismLink.href = data.data.tourism.link;
                d.tourismLink.innerHTML = `${data.data.tourism.linkText} <div class="notification-badge">!</div>`;
                
                // ãƒãƒƒã‚¸è¦ç´ ã‚’å–å¾—
                const badge = d.tourismLink.querySelector('.notification-badge');
                // ã™ã§ã«è¨ªå•æ¸ˆã¿ãªã‚‰ãƒãƒƒã‚¸ã‚’æ¶ˆã™
                if (visitedLinks[data.id]) {
                    badge.style.display = 'none';
                }

                // ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†ï¼ˆè¨ªå•æ¸ˆã¿ã«ã™ã‚‹ï¼‰
                d.tourismLink.onclick = () => {
                    visitedLinks[data.id] = true;
                    saveTourismStatus();
                    if(badge) badge.style.display = 'none';
                };
            }
            
            if(d.tourismDinoImg) {
                d.tourismDinoImg.src = data.data.tourism.dinoImg || '';
                d.tourismDinoImg.style.display = data.data.tourism.dinoImg ? 'block' : 'none';
            }
            if(d.tourismSpotImg) {
                d.tourismSpotImg.src = data.data.tourism.spotImg || '';
                d.tourismSpotImg.style.display = data.data.tourism.spotImg ? 'block' : 'none';
            }
        } else if (d.tourismContainer) {
            d.tourismContainer.style.display = 'none';
        }

        if(d.section) {
            d.section.style.display = 'block';
            setTimeout(() => d.section.scrollIntoView({ behavior: 'smooth', block: 'start' }), 100);
        }
    }

    // --- UIã‚¤ãƒ™ãƒ³ãƒˆ ---
    const scrollTopBtn = document.getElementById('scroll-top-btn');
    window.addEventListener('scroll', () => {
        if (!scrollTopBtn) return;
        scrollTopBtn.classList.toggle('show', window.scrollY > 200);
    });
    if(scrollTopBtn) scrollTopBtn.addEventListener('click', (e) => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    let isSoundPlaying = false;
    function playSound(audioEl) {
        if (!audioEl || isSoundPlaying) return;
        isSoundPlaying = true;
        audioEl.currentTime = 0; audioEl.volume = 1.0;
        audioEl.play().catch(e => console.log('Audio error:', e));
        setTimeout(() => { isSoundPlaying = false; }, 300);
    }

    // --- ãƒ‘ã‚ºãƒ«ãƒ­ã‚¸ãƒƒã‚¯ ---
    const puzzle = {
        overlay: document.getElementById('puzzle-overlay'),
        target: document.getElementById('puzzle-target'),
        piece: document.getElementById('puzzle-piece'),
        area: document.getElementById('puzzle-play-area'),
        currentId: null, isComplete: false
    };

    function startPuzzle(id) {
        const data = fossils.find(f => f.id === id);
        if (!data) return;
        puzzle.currentId = id; puzzle.isComplete = false;
        
        puzzle.target.src = data.img; puzzle.piece.src = data.img;
        const dirX = Math.random() < 0.5 ? -1 : 1;
        const dirY = Math.random() < 0.5 ? -1 : 1;
        const startX = dirX * (60 + Math.random() * 60);
        const startY = dirY * (60 + Math.random() * 60);

        pDrag.currentX = pDrag.xOffset = startX;
        pDrag.currentY = pDrag.yOffset = startY;
        setTranslate(startX, startY, puzzle.piece);
        
        puzzle.piece.classList.remove('snapped', 'can-snap');
        puzzle.overlay.classList.add('active');
        enablePuzzleEvents();
    }

    let pDrag = { active: false, currentX: 0, currentY: 0, initialX: 0, initialY: 0, xOffset: 0, yOffset: 0 };
    
    function enablePuzzleEvents() {
        puzzle.piece.addEventListener("touchstart", onPuzzleDragStart, {passive: false});
        puzzle.piece.addEventListener("mousedown", onPuzzleDragStart);
        document.addEventListener("touchend", onPuzzleDragEnd);
        document.addEventListener("touchmove", onPuzzleDrag, {passive: false});
        document.addEventListener("mouseup", onPuzzleDragEnd);
        document.addEventListener("mousemove", onPuzzleDrag);
    }
    
    function disablePuzzleEvents() {
        puzzle.piece.removeEventListener("touchstart", onPuzzleDragStart);
        puzzle.piece.removeEventListener("mousedown", onPuzzleDragStart);
        document.removeEventListener("touchend", onPuzzleDragEnd);
        document.removeEventListener("touchmove", onPuzzleDrag);
        document.removeEventListener("mouseup", onPuzzleDragEnd);
        document.removeEventListener("mousemove", onPuzzleDrag);
    }

    function onPuzzleDragStart(e) {
        if(puzzle.isComplete) return;
        e.preventDefault();
        pDrag.active = true;
        const clientX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
        const clientY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
        pDrag.initialX = clientX - pDrag.xOffset;
        pDrag.initialY = clientY - pDrag.yOffset;
    }

    function onPuzzleDragEnd(e) {
        if(!pDrag.active) return;
        pDrag.initialX = pDrag.currentX;
        pDrag.initialY = pDrag.currentY;
        pDrag.active = false;
        if (getSnapDistance() < 80) puzzleSuccess();
    }

    function onPuzzleDrag(e) {
        if (!pDrag.active) return;
        e.preventDefault();
        const clientX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
        const clientY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
        
        let nextX = clientX - pDrag.initialX;
        let nextY = clientY - pDrag.initialY;

        const pieceRect = puzzle.piece.getBoundingClientRect();
        const limitX = (window.innerWidth / 2) - ((pieceRect.width || 200) / 2) - 20;
        const limitY = (window.innerHeight / 2) - ((pieceRect.height || 200) / 2) - 20;

        nextX = Math.max(-limitX, Math.min(nextX, limitX));
        nextY = Math.max(-limitY, Math.min(nextY, limitY));
        
        pDrag.currentX = pDrag.xOffset = nextX;
        pDrag.currentY = pDrag.yOffset = nextY;
        setTranslate(nextX, nextY, puzzle.piece);

        puzzle.piece.classList.toggle('can-snap', getSnapDistance() < 80);
    }
    
    function setTranslate(x, y, el) {
        el.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
    }

    function getSnapDistance() {
        const tRect = puzzle.target.getBoundingClientRect();
        const pRect = puzzle.piece.getBoundingClientRect();
        return Math.hypot(
            (tRect.left + tRect.width/2) - (pRect.left + pRect.width/2),
            (tRect.top + tRect.height/2) - (pRect.top + pRect.height/2)
        );
    }

    function puzzleSuccess() {
        if(puzzle.isComplete) return;
        puzzle.isComplete = true;
        puzzle.piece.classList.remove('can-snap');
        puzzle.piece.classList.add('snapped');
        setTranslate(0, 0, puzzle.piece);
        setTimeout(() => {
            playSound(ui.snapAudio); 
            setTimeout(() => {
                puzzle.overlay.classList.remove('active');
                disablePuzzleEvents();
                unlockFossilEffect(puzzle.currentId);
            }, 500); 
        }, 300); 
    }

    function simulateNFC(id) {
        if (!fossils.find(f => f.id === id) || unlockedStatus[id]) return;
        startPuzzle(id);
    }

    function unlockFossilEffect(id) {
        const item = document.getElementById(`item-${id}`);
        const data = fossils.find(f => f.id === id);
        
        playSound(ui.audio);
        unlockedStatus[id] = true;
        saveStatus();

        const tooltip = document.getElementById(`tooltip-${id}`);
        setMultilineText(tooltip, data.desc);
        
        if(item) {
            item.classList.remove('locked');
            item.classList.add('unlocked', 'just-unlocked');
            setTimeout(() => item.classList.remove('just-unlocked'), 600);
            createSparkles(item);
        }
        showDetails(id);
        showToast('å¾©å…ƒå®Œäº†ï¼å›³é‘‘ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸï¼');
    }

    function createSparkles(element) {
        for(let i=0; i<20; i++) {
            const sparkle = document.createElement('div');
            sparkle.classList.add('sparkle-particle');
            const angle = Math.random() * 360; 
            const distance = 60 + Math.random() * 80;
            sparkle.style.setProperty('--tx', (Math.cos(angle * Math.PI / 180) * distance) + 'px');
            sparkle.style.setProperty('--ty', (Math.sin(angle * Math.PI / 180) * distance) + 'px');
            sparkle.style.animationDelay = (Math.random() * 0.2) + 's';
            element.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1000);
        }
    }

    // --- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ ---
    let isDebugDragging = false; 
    let debugStartX, debugStartY, debugInitX, debugInitY;
    let debugXOffset = 0, debugYOffset = 0;
    const DEBUG_HANDLE = document.getElementById('debug-drag-handle');

    if (DEBUG_HANDLE) {
        const start = (e) => {
            const cX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX;
            const cY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY;
            debugInitX = cX - debugXOffset; debugInitY = cY - debugYOffset;
            if(e.target === DEBUG_HANDLE) isDebugDragging = true;
        };
        const end = () => { isDebugDragging = false; };
        const move = (e) => {
            if(!isDebugDragging) return;
            e.preventDefault();
            const cX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX;
            const cY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY;
            debugXOffset = cX - debugInitX; debugYOffset = cY - debugInitY;
            const el = document.getElementById('debug-section');
            if(el) el.style.transform = `translate3d(${debugXOffset}px, ${debugYOffset}px, 0)`;
        };
        DEBUG_HANDLE.addEventListener("mousedown", start);
        document.addEventListener("mouseup", end);
        document.addEventListener("mousemove", move);
        DEBUG_HANDLE.addEventListener("touchstart", start, {passive: false});
        document.addEventListener("touchend", end);
        document.addEventListener("touchmove", move, {passive: false});
    }

    // ãƒ‡ãƒãƒƒã‚°ãƒˆãƒªã‚¬ãƒ¼
    let tapCount = 0, tapTimer;
    const COPYRIGHT_TRIGGER = document.getElementById('copyright-trigger');
    const DEBUG_SECTION = document.getElementById('debug-section');
    const DEBUG_KEY = 'mech_debug_mode_v1';

    if (localStorage.getItem(DEBUG_KEY) === 'true' && DEBUG_SECTION) DEBUG_SECTION.style.display = 'block';

    if(COPYRIGHT_TRIGGER) {
        COPYRIGHT_TRIGGER.addEventListener('click', () => {
            tapCount++; clearTimeout(tapTimer);
            tapTimer = setTimeout(() => { tapCount = 0; }, 2000);
            const remaining = 7 - tapCount;
            if (remaining > 0 && remaining <= 5) showToast(`é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã¾ã§ã‚ã¨ ${remaining} å›ã§ã™`);
            if (tapCount >= 7) {
                if(DEBUG_SECTION) DEBUG_SECTION.style.display = 'block';
                localStorage.setItem(DEBUG_KEY, 'true');
                showToast('é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸï¼');
                tapCount = 0;
            }
        });
    }

    function disableDebugMode() {
        if(DEBUG_SECTION) DEBUG_SECTION.style.display = 'none';
        localStorage.removeItem(DEBUG_KEY);
        showToast('é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã—ã¾ã—ãŸ');
    }
    
    function resetCollection() {
        Object.keys(unlockedStatus).forEach(key => unlockedStatus[key] = false);
        // è¨ªå•å±¥æ­´ã‚‚ãƒªã‚»ãƒƒãƒˆ
        visitedLinks = {};
        localStorage.removeItem(SAVE_KEY); 
        localStorage.removeItem(TOURISM_KEY);

        fossils.forEach(f => {
            if (f.type === 'coming_soon') return;
            const item = document.getElementById(`item-${f.id}`);
            const tooltip = document.getElementById(`tooltip-${f.id}`);
            if(item) {
                item.classList.add('locked');
                item.classList.remove('unlocked', 'just-unlocked', 'selected');
            }
            setMultilineText(tooltip, f.hint);
        });
        if(ui.detail.section) ui.detail.section.style.display = 'none';
        showToast('å›³é‘‘ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    }
    
    function showToast(message) {
        const toast = document.getElementById('toast');
        if(!toast) return;
        toast.innerText = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // --- ã‚«ãƒ¡ãƒ©æ©Ÿèƒ½ãƒ­ã‚¸ãƒƒã‚¯ ---
    const cameraUI = {
        btn: document.getElementById('camera-open-btn'),
        overlay: document.getElementById('camera-overlay'),
        video: document.getElementById('camera-video'),
        close: document.getElementById('camera-close-btn'),
        shutter: document.getElementById('camera-shutter-btn'),
        stream: null
    };

    if (cameraUI.btn) {
        cameraUI.btn.addEventListener('click', async () => {
            // ã‚«ãƒ¡ãƒ©èµ·å‹•
            try {
                const constraints = { 
                    video: { facingMode: 'environment' },
                    audio: false 
                };
                cameraUI.stream = await navigator.mediaDevices.getUserMedia(constraints);
                cameraUI.video.srcObject = cameraUI.stream;
                cameraUI.overlay.classList.add('active');
                
                await cameraUI.video.play();
                showToast('ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¾ã—ãŸ');

            } catch (err) {
                console.error('Camera Error:', err);
                alert('ã‚«ãƒ¡ãƒ©ã®ä½¿ç”¨ãŒè¨±å¯ã•ã‚Œã¦ã„ãªã„ã‹ã€å¯¾å¿œã—ã¦ã„ãªã„ãƒ‡ãƒã‚¤ã‚¹ã§ã™ã€‚\nè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
        });
    }

    function stopCamera() {
        if (cameraUI.stream) {
            cameraUI.stream.getTracks().forEach(track => track.stop());
            cameraUI.stream = null;
        }
        cameraUI.overlay.classList.remove('active');
        if(aiResultBox) {
            aiResultBox.classList.remove('show');
            aiResultBox.innerText = "AIæº–å‚™ä¸­...";
        }
    }

    if (cameraUI.close) {
        cameraUI.close.addEventListener('click', stopCamera);
    }

    // ã‚·ãƒ£ãƒƒã‚¿ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆAIè§£æï¼‰
    if (cameraUI.shutter) {
        cameraUI.shutter.addEventListener('click', async () => {
            // 1. æ¼”å‡º
            playSound(ui.snapAudio);
            const flash = document.createElement('div');
            flash.style.position = 'absolute';
            flash.style.top = '0'; flash.style.left = '0';
            flash.style.width = '100%'; flash.style.height = '100%';
            flash.style.background = '#fff'; flash.style.opacity = '1';
            flash.style.transition = 'opacity 0.5s';
            cameraUI.overlay.appendChild(flash);
            setTimeout(() => { flash.style.opacity = '0'; }, 50);
            setTimeout(() => { flash.remove(); }, 500);

            // 2. AIè§£æå®Ÿè¡Œ
            if (aiModel) {
                aiResultBox.innerText = "AIè§£æä¸­...";
                aiResultBox.classList.add('show');
                
                try {
                    const predictions = await aiModel.detect(cameraUI.video);
                    console.log("Predictions:", predictions);

                    if (predictions.length > 0) {
                        const best = predictions[0];
                        const label = best.class;
                        const score = Math.round(best.score * 100);

                        let jaLabel = label;
                        if(label === 'person') jaLabel = 'äºº (Human)';
                        else if(label === 'cup') jaLabel = 'ã‚³ãƒƒãƒ—';
                        else if(label === 'chair') jaLabel = 'æ¤…å­';
                        else if(label === 'book') jaLabel = 'æœ¬';
                        else if(label === 'cat') jaLabel = 'çŒ«';
                        else if(label === 'dog') jaLabel = 'çŠ¬';
                        else if(label === 'cell phone') jaLabel = 'ã‚¹ãƒãƒ›';
                        else if(label === 'laptop') jaLabel = 'ãƒ‘ã‚½ã‚³ãƒ³';

                        aiResultBox.innerText = `æ¤œå‡º: ${jaLabel} (${score}%)`;
                    } else {
                        aiResultBox.innerText = "æ¤œå‡ºä¸èƒ½ (Unknown)";
                    }
                } catch (e) {
                    console.error(e);
                    aiResultBox.innerText = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
                }
            } else {
                showToast('AIãƒ¢ãƒ‡ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­ã§ã™...');
            }
        });
    }

    // URLãƒã‚§ãƒƒã‚¯
    const params = new URLSearchParams(window.location.search);
    const targetId = params.get('part');
    if (targetId && fossils.some(f => f.id === targetId)) {
        setTimeout(() => {
            if (!unlockedStatus[targetId]) startPuzzle(targetId);
            else {
                showDetails(targetId);
                showToast('ã“ã®åŒ–çŸ³ã¯ã™ã§ã«ç™ºè¦‹æ¸ˆã¿ã§ã™');
                const item = document.getElementById(`item-${targetId}`);
                if (item) item.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }, 800); 
    }
</script>

</body>
</html>